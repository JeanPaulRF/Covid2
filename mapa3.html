<!DOCTYPE html>
<html>
    <head>
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
        <title>Heatmap casos</title>
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
        <style>
        body { margin: 0; padding: 0; }
        </style>
        <style>
            h1 {text-align: center;}
            p {text-align: center;}
            div {text-align: center;}
            .container {
                max-width: 500px;
  margin: auto;
                }

                .vertical-center {
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                -ms-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
                }
            </style>
            
    </head>
    <body>
        <h1>HeatMap de casos positivos de Covid-19</h1>
        <style>
            .mapboxgl-popup {
            max-width: 400px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            }
        </style>
        <div class="container">
            <div class="vertical-center">
        <div id='map' style='width: 550px; height:550px;'></div>
            </div>
        </div>
        <script>
            mapboxgl.accessToken = 'pk.eyJ1Ijoiam14MyIsImEiOiJja3U4dDg1N2owMDd3MnVyczZ6eGVrejBrIn0.bdRyBhkl-jZwGO5A53t1Rw';
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [ -84.325842233181291, 9.590961778192716 ],
                zoom: 7,
                pitch: 0,

            });
            map.on('load', () => {
                // Add a data source containing GeoJSON data.
                    map.loadImage(
                    'https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png',
                    (error, image) => {
                    if (error) throw error;
                    map.addImage('custom-marker', image);
                    });
                map.addSource('puntos', {
                type: 'geojson',
                data: 'https://jeanpaulrf.github.io/Covid2/Clinicas.geojson'
                });
            
                map.addLayer({
                    'id': 'puntos-layer',
                        'type': 'circle',
                        'source': 'puntos',
                        'paint': {
                            'circle-color': '#4264fb',
                            'circle-radius': 6,
                            'circle-stroke-width': 2,
                            'circle-stroke-color': '#ffffff'
                        }
                });
                map.on('click', 'puntos-layer', (e) => {
// Copy coordinates array.
                    const coordinates = e.features[0].geometry.coordinates.slice();
                    const description = e.features[0].properties.name;
                    
                    // Ensure that if the map is zoomed out such that multiple
                    // copies of the feature are visible, the popup appears
                    // over the copy being pointed to.
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }
                    
                    new mapboxgl.Popup()
                    .setLngLat(coordinates)
                    .setHTML(e.features[0].properties.TIPO + " " + e.features[0].properties.NOMBRE + " en " + e.features[0].properties.CANTON)
                    .addTo(map);
                    });
                    
                    // Change the cursor to a pointer when the mouse is over the places layer.
                    map.on('mouseenter', 'puntos-layer', () => {
                    map.getCanvas().style.cursor = 'pointer';
                    });
                    
                    // Change it back to a pointer when it leaves.
                    map.on('mouseleave', 'puntos-layer', () => {
                    map.getCanvas().style.cursor = '';
                    });
                    map.addSource('hospitales', {
                type: 'geojson',
                data: 'https://jeanpaulrf.github.io/Covid2/Hospitales.geojson'
                });
            
                map.addLayer({
                    'id': 'hospitales-layer',
                        'type': 'circle',
                        'source': 'hospitales',
                        'paint': {
                            'circle-color': '#FF0000',
                            'circle-radius': 6,
                            'circle-stroke-width': 2,
                            'circle-stroke-color': '#ffffff'
                        }
                });
                map.on('click', 'hospitales-layer', (e) => {
// Copy coordinates array.
                    const coordinates = e.features[0].geometry.coordinates.slice();
                    const description = e.features[0].properties.name;
                    
                    // Ensure that if the map is zoomed out such that multiple
                    // copies of the feature are visible, the popup appears
                    // over the copy being pointed to.
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }
                    
                    new mapboxgl.Popup()
                    .setLngLat(coordinates)
                    .setHTML(e.features[0].properties.NOMBRE + " en " + e.features[0].properties.CANTON)
                    .addTo(map);
                    });
                    
                    // Change the cursor to a pointer when the mouse is over the places layer.
                    map.on('mouseenter', 'hospitales-layer', () => {
                    map.getCanvas().style.cursor = 'pointer';
                    });
                    
                    // Change it back to a pointer when it leaves.
                    map.on('mouseleave', 'hospitales-layer', () => {
                    map.getCanvas().style.cursor = '';
                    });
            });
            </script>
    </body>
</html>